---
import Base from '@layouts/Base.astro';
import Breadcrumbs from '@components/Breadcrumbs.astro';
import PolicyHero from '@components/PolicyHero.astro';

const site = Astro.site?.toString?.() || 'http://localhost:4321';

const faqs = [
  {
    q: "Do you sell my personal information?",
    a: "No. We do not sell personal information. We may share it with vetted processors (e.g., hosting, email, couriers) under written agreements that meet POPIA safeguards." 
  },
  {
    q: "How long do you keep my data?",
    a: "Service records ~3 years, financial records ≥5 years (legal/tax), remote session logs up to 30 days, incident records ≥3 years; after that, secure deletion or anonymisation."
  },
  {
    q: "Do you process special personal information?",
    a: "Not intentionally. If strictly necessary, we rely on an applicable POPIA ground (e.g., explicit consent), apply heightened safeguards, and document the justification."
  },
  {
    q: "Are there cross-border transfers?",
    a: "Yes, where needed (e.g., reputable cloud services) and only with adequate protection, consent, contract necessity, or other POPIA s72 grounds."
  },
  {
    q: "How do I exercise POPIA rights?",
    a: "Email the Information Officer at digissentialteam@gmail.com. We verify identity and respond within a reasonable time, not exceeding 30 days unless an extension applies."
  }
];

const faqLd = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(f => ({
    "@type": "Question",
    "name": f.q,
    "acceptedAnswer": { "@type": "Answer", "text": f.a }
  }))
};

const policyLd = {
  "@context": "https://schema.org",
  "@type": "PrivacyPolicy",
  "name": "Privacy & POPIA",
  "url": new URL('/legal/privacy', site).toString(),
  "inLanguage": "en-ZA",
  "publisher": { "@type": "Organization", "name": "Digissential" }
};
---

<Base title="Privacy & POPIA — Digissential" description="How Digissential collects, uses, safeguards, and shares personal information in line with POPIA.">
  <!-- Breadcrumbs -->
  <main class="container-prose pt-6">
    <Breadcrumbs items={[
      { href: '/legal', label: 'Trust' },
      { href: '/legal/privacy', label: 'Privacy (POPIA)' },
    ]} />
  </main>

  <!-- Brandful hero -->
  <PolicyHero
    title="Privacy & POPIA"
    subtitle="We collect only what’s necessary, keep it secure, and respect your rights under South African law."
    badges={["POPIA-aligned", "Minimal collection", "Security safeguards"]}
  >
    <svg slot="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
      <path d="M12 22s8-4 8-10V7l-8-4-8 4v5c0 6 8 10 8 10z"/>
    </svg>
  </PolicyHero>

  <!-- Content -->
  <main class="container-prose pb-20 prose prose-invert max-w-3xl">
    <section class="grid gap-6 md:grid-cols-2">
      <article class="card p-6 border-l-4 border-l-emerald-400/70">
        <h2 class="text-xl font-bold">What we collect</h2>
        <ul class="mt-3 space-y-2 text-sm text-white/80 list-disc pl-5">
          <li>Identification & contact: name, email, phone, address.</li>
          <li>Device & service data: serials, specs, service logs, error reports, configuration, device photos.</li>
          <li>Transaction & billing: quotes, invoices, payments, VAT details (where applicable).</li>
          <li>Communications: emails, messages, call notes; remote session metadata (timestamps, session IDs).</li>
          <li>Limited verification for fraud prevention.</li>
          <li><em>Special personal information:</em> not intentionally collected; any incidental exposure is accessed only as strictly necessary with safeguards.</li>
        </ul>
      </article>

      <article class="card p-6 border-l-4 border-l-sky-400/70">
        <h2 class="text-xl font-bold">Why we process</h2>
        <ul class="mt-3 space-y-2 text-sm text-white/80 list-disc pl-5">
          <li>Service delivery: diagnostics, repair, configuration, remote support, custom builds.</li>
          <li>Client management: intake, scheduling, job tracking, communications, handover.</li>
          <li>Billing & accounting, legal compliance (tax, CPA, second-hand goods records).</li>
          <li>Security & fraud prevention; incident response and investigation.</li>
          <li>Quality control and training (limited review of logs/records).</li>
        </ul>
      </article>
    </section>

    <section class="mt-8 grid gap-6 md:grid-cols-2">
      <article class="card p-6">
        <h3 class="font-semibold">Cross-border transfers</h3>
        <p class="mt-2 text-sm text-white/80">
          Transfers/storage outside South Africa may occur (e.g., reputable cloud providers) only where adequate protection exists, or with consent, contract necessity, or other POPIA s72 grounds.
        </p>
      </article>
      <article class="card p-6">
        <h3 class="font-semibold">Direct marketing</h3>
        <p class="mt-2 text-sm text-white/80">
          Electronic direct marketing to new prospects happens only with prior, express consent; existing clients may receive similar service updates with a no-cost opt-out.
        </p>
      </article>
    </section>

    <!-- Rights & request flow -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold">Your rights under POPIA</h2>
      <ul class="mt-3 space-y-2 text-sm text-white/80 list-disc pl-5">
        <li>To be informed about the collection and use of your personal information.</li>
        <li>To access and receive a copy of your personal information.</li>
        <li>To request correction or deletion where appropriate.</li>
        <li>To object to certain processing and to withdraw consent where processing is based on consent.</li>
      </ul>

      <h3 class="mt-6 font-semibold">How to exercise your rights</h3>
      <ol class="mt-3 space-y-3">
        <li class="flex gap-3">
          <span class="mt-1 inline-flex h-7 w-7 shrink-0 items-center justify-center rounded-full border border-white/10 bg-white/5 text-sm">1</span>
          <p>Email <a class="link-fancy" href="mailto:digissentialteam@gmail.com">digissentialteam@gmail.com</a> and describe the request (access, correction, deletion, objection).</p>
        </li>
        <li class="flex gap-3">
          <span class="mt-1 inline-flex h-7 w-7 shrink-0 items-center justify-center rounded-full border border-white/10 bg-white/5 text-sm">2</span>
          <p>We verify your identity and may request reasonable details to locate your records.</p>
        </li>
        <li class="flex gap-3">
          <span class="mt-1 inline-flex h-7 w-7 shrink-0 items-center justify-center rounded-full border border-white/10 bg-white/5 text-sm">3</span>
          <p>We respond within a reasonable timeframe and explain the outcome, including any lawful basis for refusing or limiting a request.</p>
        </li>
      </ol>
    </section>

    <!-- Download CTA + policy hub -->
    <section class="mt-10 grid gap-6 md:grid-cols-[1fr,auto] items-center">
      <div class="card p-6 flex items-center gap-4">
        <span class="inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-white/10 bg-white/5">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M12 3v12m0 0l-4-4m4 4l4-4M5 21h14" />
          </svg>
        </span>
        <div class="flex-1">
          <p class="font-semibold">Download the Privacy & POPIA Notice</p>
          <p class="text-sm text-white/70">Complete details including purposes, retention, and your rights.</p>
        </div>
        <a class="btn btn-primary" href="/legal/privacy-popia-processing-notice.pdf" download>Download PDF</a>
      </div>

      <a class="btn btn-outline" href="/legal">See all policies</a>
    </section>

    <!-- FAQ -->
    <section class="mt-10">
      <h2 class="text-2xl font-bold">FAQ</h2>
      <ul class="mt-4 space-y-4">
        {faqs.map(f => (
          <li class="card p-5">
            <p class="font-semibold">{f.q}</p>
            <p class="text-white/80 mt-1">{f.a}</p>
          </li>
        ))}
      </ul>
    </section>

    <script type="application/ld+json">{JSON.stringify(faqLd)}</script>
    <script type="application/ld+json">{JSON.stringify(policyLd)}</script>
  </main>
</Base>
