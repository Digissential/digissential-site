---
import Base from '@layouts/Base.astro';
import Section from '@components/Section.astro';
import Button from '@components/Button.astro';
import Badge from '@components/Badge.astro';
import PriceCard from '@components/PriceCard.astro';
import FeatureCard from '@components/FeatureCard.astro';
import Trust from '@components/Trust.astro';
import { getCollection } from 'astro:content';
const services = await getCollection('services');
const featured = services.filter(s => s.data.featured);
const others = services.filter(s => !s.data.featured);
---
<Base>
  <a id="top" class="sr-only">Top</a>

  <section class="relative z-0 hero-bg pt-28 sm:pt-32 pb-14 bg-gradient-to-b from-digi-bg to-digi-ink/60">
    <div class="container-prose grid gap-10 md:grid-cols-2 items-center">
      <div class="relative">
        <img src="/assets/hero-tech.svg" alt="" aria-hidden="true" class="pointer-events-none absolute -right-10 -top-6 w-40 md:w-56 opacity-40" />
        <Badge label="Stellenbosch • Computer Repair & IT Support" size="lg" />
        <h1 class="mt-4 text-4xl sm:text-5xl font-extrabold leading-tight">
          Keeping your <span class="text-digi-primary">tech essentials</span> perfect.
        </h1>
        <p class="mt-4 text-white/80 max-w-xl">Fast, honest repairs and support: Windows installs, data recovery, malware removal, upgrades, and remote help. No tech jargon — just real solutions.</p>
        <div class="mt-8 flex flex-wrap gap-3">
          <Button href="/contact" class="w-full sm:w-auto">Get a free quote</Button>
          <Button href="/services" variant="ghost" class="w-full sm:w-auto">View services</Button>
          <Button href="tel:+27664256314" variant="secondary" class="w-full sm:w-auto">Call now</Button>
        </div>
        <p class="mt-4 text-xs text-white/60">Transparent rates • POPIA‑aligned privacy • CPA‑aligned warranty</p>
      </div>
      <div class="relative">
        <div class="card p-6">
          <h3 class="font-semibold">Quick Contact</h3>
          <form name="quick-contact" method="POST" data-netlify="true" data-netlify-honeypot="bot-field" class="mt-4 grid gap-5" action="/contact/success">
            <input type="hidden" name="form-name" value="quick-contact" />
            <p class="hidden"><label>Don’t fill this out: <input name="bot-field" /></label></p>
            <label class="text-sm">Name
              <input required name="name" placeholder="Your Name" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-digi-primary"/>
            </label>
            <label class="text-sm">Email
              <input required type="email" name="email" placeholder="your.email@example.com" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-digi-primary"/>
            </label>
            <fieldset class="text-sm">
              <legend class="mb-1 text-white/80">Common issues (select any)</legend>
              <div class="flex flex-wrap gap-3 text-xs">
                <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Malware Removal" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Malware Removal</label>
                <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Data Recovery" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Data Recovery</label>
                <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Windows Reinstall" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Windows Reinstall</label>
                <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Performance" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Performance</label>
                <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Other" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Other</label>
              </div>
            </fieldset>
            <div class="md:hidden grid gap-2 text-sm">
              <label>Issue type (quick select)
                <select name="issue_select" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2">
                  <option value="">Choose an option</option>
                  <option>Malware Removal</option>
                  <option>Data Recovery</option>
                  <option>Windows Reinstall</option>
                  <option>Performance</option>
                  <option>Other</option>
                </select>
              </label>
            </div>
            <label class="text-sm">What can we help with?
              <textarea required name="message" rows="3" maxlength="500" data-count-target="#qc-count" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-digi-primary" placeholder="Describe the issue briefly (max 500 chars)"></textarea>
            </label>
            <div class="text-xs text-white/60" aria-live="polite">Characters: <span id="qc-count">0</span>/500</div>
            <label class="flex items-center gap-2 text-sm text-white/80 font-semibold"><input type="checkbox" required class="accent-digi-primary h-5 w-5"/> I consent to handling of my info for contact (POPIA).</label>
            <button class="rounded-xl2 bg-digi-primary px-4 py-2 font-semibold hover:brightness-110">Send</button>
          </form>
        </div>
      </div>
    </div>
  </section>


  <Section id="services" eyebrow="Services" title="What we do" description="Core services that solve 90% of everyday computer problems.">
    <div class="grid gap-6 md:grid-cols-3">
      <FeatureCard title="Windows Reinstalls" body="Clean installs, drivers, updates, and basic configuration for a fresh start.">
        <svg slot="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 5h7v7H3zM14 5h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/></svg>
      </FeatureCard>

      <FeatureCard title="Malware Removal" body="Deep scans and safe removal with a basic hardening baseline afterward.">
        <svg slot="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1v22M1 12h22M4.93 4.93l14.14 14.14M19.07 4.93L4.93 19.07"/></svg>
      </FeatureCard>

      <FeatureCard title="Backups & Recovery" body="Backups before repair; best-effort recovery for accidental loss.">
        <svg slot="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4v6h6M20 20v-6h-6M5 19a9 9 0 1 0 0-14"/></svg>
      </FeatureCard>
    </div>
  </Section>



  <Section id="pricing" eyebrow="Pricing" title="Transparent, simple rates" description="No surprises. Most fixes start with these baseline rates.">
    <div class="grid gap-6 md:grid-cols-3">
      {featured.map((s) => (
        <PriceCard title={s.data.title} price={s.data.price} bullets={s.data.bullets} ctaHref={`/services/${s.slug}`} ctaLabel="View details" />
      ))}
    </div>
    {others.length > 0 && (
      <div class="mt-6 grid gap-4 sm:grid-cols-2">
        {others.map((s) => (
          <a href={`/services/${s.slug}`} class="card p-4 flex items-center justify-between hover:bg-white/10 transition">
            <div>
              <h4 class="font-semibold">{s.data.title}</h4>
              <p class="text-sm text-white/70">{s.data.bullets[0]}</p>
            </div>
            <span class="text-digi-primary font-bold">{s.data.price}</span>
          </a>
        ))}
      </div>
    )}
  </Section>

  <Trust />

  <Section id="contact" eyebrow="Contact" title="Get help today" description="Fast replies during business hours. Remote support available.">
    <div class="grid gap-6 md:grid-cols-2">
      <div class="card p-6">
        <h3 class="font-semibold">Request a Quote</h3>
        <form name="quote" method="POST" data-netlify="true" data-netlify-honeypot="bot-field" class="mt-4 grid gap-5">
          <input type="hidden" name="form-name" value="quote" />
          <p class="hidden"><label>Don’t fill this out: <input name="bot-field" /></label></p>
          <label class="text-sm">Full Name<input required name="name" placeholder="Your Name" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-digi-primary"/></label>
          <label class="text-sm">Phone<input required type="tel" name="phone" placeholder="071 234 5678" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-digi-primary"/></label>
          <label class="text-sm">Email<input required type="email" name="email" placeholder="your.email@example.com" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-digi-primary"/></label>
          <fieldset class="text-sm">
            <legend class="mb-1 text-white/80">Common issues (select any)</legend>
            <div class="flex flex-wrap gap-3 text-xs">
              <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Malware Removal" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Malware Removal</label>
              <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Data Recovery" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Data Recovery</label>
              <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Windows Reinstall" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Windows Reinstall</label>
              <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Performance" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Performance</label>
              <label class="inline-flex items-center gap-2 leading-none"><input type="checkbox" name="issue_type" value="Other" class="accent-digi-primary h-4 w-4 align-middle translate-y-[1px]">Other</label>
            </div>
          </fieldset>
          <div class="md:hidden grid gap-2 text-sm">
            <label>Issue type (quick select)
              <select name="issue_select" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2">
                <option value="">Choose an option</option>
                <option>Malware Removal</option>
                <option>Data Recovery</option>
                <option>Windows Reinstall</option>
                <option>Performance</option>
                <option>Other</option>
              </select>
            </label>
          </div>
          <label class="text-sm">Device & Issue<textarea required name="issue" rows="4" maxlength="700" data-count-target="#q-count" class="mt-1 w-full rounded-xl2 bg-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-digi-primary" placeholder="Describe the device and problem (max 700 chars)"></textarea></label>
          <div class="text-xs text-white/60" aria-live="polite">Characters: <span id="q-count">0</span>/700</div>
          <label class="flex items-center gap-2 text-sm text-white/80 font-semibold"><input type="checkbox" required class="accent-digi-primary h-5 w-5"/> I consent to handling of my info for quoting (POPIA).</label>
          <button class="rounded-xl2 bg-digi-primary px-4 py-2 font-semibold hover:brightness-110">Submit</button>
        </form>
      </div>
      <div class="card p-6">
        <h3 class="font-semibold">Direct Contact</h3>
        <ul class="mt-3 space-y-2 text-white/80">
          <li>Phone: <a class="hover:text-white" href="tel:+27664256314">066 425 6314</a></li>
          <li>Email: <a class="hover:text-white" href="mailto:digissentialteam@gmail.com">digissentialteam@gmail.com</a></li>
          <li>Service area: Stellenbosch & surrounds</li>
        </ul>
        <div class="mt-6">
          <iframe title="Map" class="w-full h-56 rounded-xl2 border border-white/10" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3311.427!2d18.85!3d-33.93!2m3!1f0!2f0!3f0!"></iframe>
        </div>
      </div>
    </div>
  </Section>

  <script is:inline>
    const attachCounter = (sel) => {
      document.querySelectorAll(sel).forEach((ta) => {
        const out = document.querySelector(ta.getAttribute('data-count-target'));
        const update = () => { if (out) out.textContent = String(ta.value.length); };
        ta.addEventListener('input', update);
        update();
      });
    };
    attachCounter('textarea[data-count-target]');
  </script>

</Base>
